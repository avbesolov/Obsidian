#вопросы_с_собесов #k8s #kubernetes

#### Кубер
Система для управления контейнерами в кластерной среде. Позволяет управлять серверами, на которых запущены контейнеры, и самими контейнерами на них, а также повышает утилизацию запуская множество контейнеров на одном сервере.
#### Из каких компонентов состоит k8s и каково их назначение?  
K8s состоит из control plane и data plane.Control plane — управляющий контур, который запускается в пределах нод, называемых master, и может запускаться как в одиночном режиме (single master), так и в распределённом (multi master).

Control plane содержит:

- ETCD — хранилище конфигурации кластера;
- Kubernetes API — предоставляет API, посредством которого взаимодействуют компоненты k8s, а также клиенты, находящиеся внутри и вне кластера;
- Kubernetes controller manager — реализует концепцию контроллеров, которые управляют базовыми сущностями кластеров (например, node controller, job controller, endpoint slice controller);
- Kubernetes scheduler — выбирает ноды, на которых нужно запускать PODы; 
- cloud controller manager — используется для реализации функций работы с облаком (если кластер k8s запущен в облаке).

Data plane — компоненты, которые запущены на каждой ноде:

- kubelet — следит за изменениями конфигурации ноды, применяет изменения конфигурации, делает пробы контейнеров, отчитывается о статусе контейнеров, работает с CRI-плагином и реализует функции запуска и остановки контейнеров;
- kube-proxy — отвечает за сетевой компонент: работает с CNI-плагином и обеспечивает функционирование сущности “сервис” (service) в пределах своей ноды.  
#### По какой модели общаются друг с другом компоненты кубера?  
По pull модели
#### Что такое Kubernetes probes?  
Это проверки, которые осуществляются в течение жизненного цикла PODа. Они описываются для каждого контейнера PODа. Существуют три вида проверок.  
  
1.       Startup probe — запускается сразу после старта PODа и применяется для приложений, которые имеют длительную процедуру инициализации. Пока она не завершена, другие пробы не запускаются.

2.       Readiness probe — проверка готовности PODа обрабатывать трафик (POD не добавляется в маршрутизацию трафика в service, если эта проверка не пройдена).

3.       Liveness probe — проверяет, функционирует ли приложение (в случае, если проверка не завершилась успехом, процесс в контейнере PODа перезапускается).
#### Сущности кубера:

**Deployment –** объект, в котором хранится описание подов, кол реплик и алгоритм их замены в случае изменения параметров. Описывает необходимое состояние пода. 

**Service** – описывается как поды будут взаимодействовать друг с другом внутри приватной сети

В Kubernetes существует несколько вариантов предоставления доступа к сервисам, которые называются **типами (ServiceTypes)**:

1.      **ClusterIP** — предоставляет доступ к сервису на внутреннем IP-адресе кластера (сервис доступен только внутри кластера).

2.      **NodePort** — предоставляет доступ к сервису на IP-адресе каждого узла (ноды) кластера, на статическом порту (из диапазона 30000–32767).

3.      **LoadBalancer** — предоставляет доступ к сервису с использованием балансировщика (load balancer) облачного провайдера.

4.      **ExternalName** — сопоставляет имя сервиса с содержимым поля externalName, возвращая CNAME-запись.

**StatefulSet** – практически аналогичен деплойменту, за исключением того что после выключения или рестарта пода через стейтфулсет данные из него не теряются (К примеру БД)StatefulSet – это **контроллер Kubernetes, применяемый для эксплуатации сохраняющих состояние приложений в виде контейнеров (подов) в кластере Kubernetes**. StatefulSet присваивают каждому поду идентификатор-липучку (sticky identity) – порядковый номер начиная с нуля — а не случайные ID каждой реплике пода. Новый под создается клонированием данных уже существовавшего пода.

----
**Ответ, если не знаешь: «К сожалению, мне не приходилось сталкиваться с подобными кейсами на практике. Но я могу достаточно быстро найти ответ на этот вопрос при помощи поискового сервиса или нейронки, если возникнет такая необходимость»**

Еще полезная статейка - [https://dmatveeva.github.io/kubernetes-cheatsheet/](https://dmatveeva.github.io/kubernetes-cheatsheet/)

----
#### Стратегии деплоя:  
В Kubernetes существует несколько стратегий деплоя, вот некоторые из них:

1.      **Rolling deployment** — стратегия по умолчанию, которая позволяет обновлять набор модулей без простоя.

2.      **Recreate deployment** — метод, который позволяет мгновенно обновлять приложение с некоторым временем простоя.

3.      **Ramped slow rollout** — стратегия, которая позволяет развернуть реплики новой версии, параллельно закрывая старые реплики.

4.      **Best-effort controlled rollout** — стратегия, которая определяет параметр «max unavailable», указывающий, какой процент существующих модулей может быть недоступен во время обновления.

5.      **Blue/green deployment** — стратегия, которая создает две отдельные, но идентичные среды.

6.      **Canary deployment** — использует прогрессивный подход доставки, при котором одна версия приложения обслуживает большинство пользователей, а другая, более новая версия — небольшой пул тестовых пользователей.

7.      **Shadow deployment** — новая версия приложения получает реальный трафик вместе с текущей версией, но без влияния на конечных пользователей.

8.      **A/B testing** — стратегия, которая позволяет одновременно развернуть две или более версии функции приложения для подмножества пользователей. 
#### Sidecar-контейнер
это контейнер, который должен быть запущен рядом с  
основным контейнером внутри пода. Этот паттерн нужен для расширения и улучшения функциональности основного приложения без внесения в него изменений.  
#### kubectl describe
это инструмент для мониторинга и отладки кластера Kubernetes.

Он предлагает быстрый подход к получению полной информации о ресурсе, что упрощает понимание текущего состояния ресурса и выявление проблем.

Команда показывает детали о статусе ресурса, событиях и метаданных.

Пример использования:

`kubectl describe deployment my-nginx`

Эта команда позволяет получить подробную информацию о развертывании my-nginx, включая статус развертывания, произошедшие события и связанные с ним метаданные.
#### Контроллер Ingress
Ingress обеспечивает доступ к модулю через внешний IP-адрес и позволяет балансировать нагрузку трафика.
#### Какие компоненты мастер-узла (Control Plane) Kubernetes и каково их назначение?  
[https://habr.com/ru/companies/slurm/articles/713884/](https://habr.com/ru/companies/slurm/articles/713884/)  
#### StatefulSet vs Deployment 
![[ss_vs_dp.png]]
  
****Headless-сервис используется в StatefulSet, когда требуется прямая связь с pod’ом.**

В приложениях с состоянием, например, в базах данных, вторичные pod’ы должны напрямую взаимодействовать с первичными pod’ами для репликации данных между репликами.

Headless позволяет DNS разрешать pod’ы и получать к ним доступ по имени pod’а.

Для доступа к pod’у через Headless-сервис необходимо воспользоваться следующим доменным именем: <pod-name>.<service-name>.<namespace>.svc.cluster.local.


  
  
  
