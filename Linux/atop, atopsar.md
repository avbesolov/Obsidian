#### atop
это продвинутый интерактивный полноэкранный монитор производительности.
Он является аналогом top, но в отличие от него выводит только новые изменения об активных системных процессах.
Важной особенностью является возможность сохранения данных в файл собственного двоичного формата.

**Основные параметры**
- Строка **PRC** – отображает общие данные на уровне процессов и потоков:
    - sys, user – общее время процессора, затраченное в системном режиме и в пользовательском режиме соответственно; 
    - proc – общее количество процессов, активных в системе на текущий момент;
    - trun – общее количество потоков, активных в данный момент;
    - tslpi – общее количество потоков, которые сейчас находятся в спящем режиме и могут быть прерваны;
    - tslpu – общее количество потоков, которые в текущее время находятся в спящем режиме и не могут быть прерваны;
    - zombie – количество процессов-зомби;
    - clones – количество системных вызовов клонов для процессов;
    - exit – количество процессов, завершившихся за прошедшее время.
- Строка **CPU** – выводит общие данные о нагрузке на центральный процессор. Верхняя строка показывает общую занятость для всего процессора. В случае многоядерной системы для каждого отдельного ядра отображается дополнительные строки с «cpu» в нижнем регистре, отсортированные по активности. Для каждого ядра и всего процессора содержатся следующие показатели:
    - sys, user – общее время процессора, затраченное в системном режиме и в пользовательском режиме соответственно;
    - irq – процент времени процессора, затраченного на обработку прерываний;
    - idle – процент неиспользованного времени процессора, когда ни один из процессов не ожидает дискового ввода-вывода;
    - wait – процент неиспользованного времени процессора, пока по крайней мере один процесс ждал дисковый ввод-вывод;
- Строка **CPL** – показывает  LA (Load Average) за 1, 5 и 15 минут, а также количество доступных ядер процессора.
- Строка **MEM** – показывает общую информацию об оперативной памяти:
    - tot – общий объем доступной оперативной памяти;
    - free – общий объем свободной памяти;
    - cache – текущий объем кэш-памяти;
    - dirty – объем памяти в страничном кэше, который необходимо сбросить на диск;
    - buff  – объем памяти, используемый для метаданных файловой системы;
- Строка **Swap** – показывает общую информацию о swap.
- Строка **DSK** — показывает использование диска:
    - busy – процент времени, в течение которого система занята обработкой запросов;
    - read – выданные запросы на чтение;
    - write – выданные запросы на запись;
    - KiB/r и KiB/w – скорость чтения и записи данных (в КB) на каждый запрос;
    - MBr/s и MBw/s – временные показатели для чтения и записи на диск в мегабайтах.
    - avio – среднее количество миллисекунд, затраченных на обработку запросов.
- Строки **NET** – показывают общую статистику использованию сети на транспортном и сетевом уровне, а также отдельно по каждому активному сетевому интерфейсу.
  
-----

**Во время работы программы можно применять следующие горячие клавиши для изменения нижней части окна:**

- **для изменения отображения таблицы процессов — отвечает за просмотр:**

        'm' - памяти, используемой процессами;
        'd'  - использования диска процессами;
        'n'  - использования сети;
        'v'  - детальной информации по  процессам (ppid, user/group, date/time, status, exitcode)
        'c'  - полной команды для каждого процесса.

- **для сортировки по использованию:**

        'C'  - процессора;
        'M' - оперативной памяти;
        'D'  - оперативной дисковой системы;
        'N'  - оперативной дисковой сети;
        'A'  -  самые активные пользователи ресурсов (auto mode).

- **для суммирования:**

        'u'  - по пользователям системы;
        'p'  - по процессам.

 - **для поиска* — фокус на определённом:**

        'U'  - пользователе системы;
        'P'  - процессе по названию;
        'I'  - процессе по PID;
        '/'  - выражении командной строки или её части.
        
-----

**Общий вывод команды `atop` отображает следующие сведения для каждой записи процесса:**

- PID – идентификатор процесса.
- SYSCPU — объем ЦП, потребляемый процессом при работе системы.
- USRCPU – количество ЦП, потребляемое процессом во время его работы в пользовательском режиме.
- VGROW – объем виртуальной памяти, которую процесс занял с момента последнего обновления значения.
- RGROW — объем резидентной (физической) памяти, увеличенный с момента последнего обновления значения.
- RDDSK — размер данных, передаваемых во время чтения с диска.
- WRDSK — размер данных, передаваемых во время записи на диск.
- RUID – реальный идентификатор пользователя, под которым выполняется процесс.
- EUID — эффективный идентификатор пользователя, под которым выполняется процесс.
- ST – текущий статус процесса.
- EXC – код выхода после завершения процесса.
- THR — количество потоков в процессе.
- S – текущий статус основного потока процесса.
- ЦП – процент использования ЦП для всего процесса.
- CMD — имя процесса.

**Потребление памяти**
`atop -m`

- PID – идентификатор процесса.
- TID – идентификатор потока.
- MINFLT – количество незначительных ошибок страниц, которые были устранены путем доступа к данным с бесплатных страниц.
- MAJFLT – количество серьезных ошибок страниц, которые были устранены путем извлечения данных с диска.
- VSTEXT — виртуальная память, занятая текстом процесса.
- VSLIBS – виртуальная память, занимаемая общими библиотеками процесса.
- VDATA — размер виртуальной памяти для частных данных процесса.
- VSTACK — размер виртуальной памяти частного стека процесса.
- VSIZE — общий размер виртуальной памяти процесса.
- RSIZE — общая резидентная память, занятая процессом.
- MEM — процент оперативной памяти, потребляемой процессом.

**Использование диска**
`atop -d`

В выводе, специфичном для диска, не так много вещей, на которые можно обратить внимание. Вот некоторые из ключевых выводов:

- RDDSK — размер данных, передаваемых во время чтения с диска.
- WRDSK — размер данных, передаваемых во время записи на диск.
- WCANCL — размер данных, изначально записанных, но позже удаленных.
- DSK – процент занятого места на диске.
- CMD — имя процесса.

**Еще команды**
`atop -c` - просмотреть процессы работающие в фоновом режиме
`atop -y` - информация по потокам
`atop -v` - подробнее о процессе
`atop -au` - количество процессов для каждого пользователя в системе
`atop -s` - на каком ядре работает процесс

https://firstvds.ru/technology/statistika-nagruzki-na-server-atop - работа с atop

#### atopsar
Команда atopsar — это встроенный анализатор логов atop, который позволит быстро найти проблему и смотреть лог в нужное вам время.

**Общая структура команды:**
`atopsar [-flags] [-r file|date|y...] [-R cnt] [-b hh:mm] [-e hh:mm]`

Все логи сохраняются в каталоге по пути **/var/log/atop/**, файлы именуются по формату `atop_<дата>`.

Основные ключи:

- **-r** — считывание данных из файла;
- **-b** — с какого времени вывести лог;
- **-e** — до какого времени вывести лог.

Дополнительные опции для анализа:

- **-d** — нагрузка на каждый диск;
- **-m** — нагрузка на оперативную память и **swap**;
- **-с** — нагрузка на процессор, отдельно по каждому ядру;
- **-p** — количество процессов и потоков;
- **-w** — нагрузка на сетевой трафик;
- **-i** — нагрузка на интерфейс;
- **-O** — топ-3 процессов по использованию процессора;
- **-G** — топ-3 процессов по использованию памяти;
- **-D** — топ-3 процессов по использованию диска;
- **-N** — топ-3 процессов по использованию сети;
- **-A** — все возможные отчеты.

Например, можно смотреть нагрузку на диск по анализу логов за определенный день и время, используя ключ **-d**:  

`atopsar -r /var/log/atop/atop_20231130 -d -b 14:00 -e 16:00`

https://redos.red-soft.ru/base/manual/utilites/atopsar/ - работа с atopsar