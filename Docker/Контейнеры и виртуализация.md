#вопросы_с_собесов #docker 

cheatsheet - https://github.com/eon01/DockerCheatSheet

#### Мультистейдж сборка.  
Не всё, что есть в образе, нужно нам в продакшене.  

При таком подходе используется промежуточный контейнер, который содержит все необходимые инструменты для компиляции артефактов (таких как бинарные файлы). После этого вы копируете в итоговый образ только необходимы артефакты без лишних инструментов, зависимостей и временных файлов.

Хорошо подготовленная многоступенчатая сборка содержит лишь необходимые бинарные файлы и зависимости в итоговом образе и не содержит инструментов для сборки и промежуточных файлов.
#### Какую работу делал своими руками с докером и кубером?
Собирал образ с джава приложением на одной ноде.  
Пушил в докер реджистри (настроенный на базе Нексуса)  
Стягивал образ и деплоил приложение в контейнере на другой ноде.  
Приложение в контейнере собиралось мавеном, запускалось томкатом.  
А пинал все это дело дженкинс  
#### Отличие CMD и ENTRYPOINT  
Если во время выполнения определена только одна из инструкций, то и CMD и ENTRYPOINT будут иметь одинаковый эффект.

CMD может дополнять конструкцию ENTRYPOINT только в определенном режиме (shell, exec)  
Команды CMD можно переопределять при запуске контейнера[https://devops.org.ru/dockerfile-summary#d20](https://devops.org.ru/dockerfile-summary#d20)  
#### USER  
Инструкция USER устанавливает имя пользователя (UID) от имени которого будет запущен образ, а также инструкции RUN, CMD и ENTRYPOINT содержащиеся в Dockerfile.  
#### Что представляет собой докер-контейнер? Из каких двух базовых вещей состоят контейнеры (имеется ввиду namespaces и cgroups)?  
Контейнер Docker — это популярный легкий автономный выполняемый контейнер, который включает в себя всё необходимое для запуска приложения, в том числе библиотеки, системные инструменты, код и среду выполнения.

Cgroups – управление ресурсами, 
Namespaces – изолированное пространство (изоляция процессов)
#### Как называется механизм, с помощью которого ограничиваются ресурсы контейнера?
**CGroup**, полное название группы управления Linux, является функцией ядра Linux, используемой для ограничения, управления и разделения ресурсов группы процессов (таких как ЦП, память, ввод и вывод диска и т. Д.).  
**namespaces** – механизм обеспечивает полную изоляцию среды.  
#### Что такое гипервизор? 
инструмент параллельного управления несколькими операционными системами (ОС) на одном компьютере (хосте)  

Программный гипервизор — **это** эмулятор, программа, которая запускается внутри операционной системы и имитирует работу виртуального компьютера.  

Гипервизор — это **программный уровень, расположенный между оборудованием и одной или несколькими операционными системами**. Его основной задачей является предоставление изолированных сред выполнения, называемых разделами. 
#### Отличие виртуализации от контейнерезации?
Виртуальная машина изолируется полностью средствами процессора (технологии Intel, AMD, VMX).

Контейнер работает на ядре хостовой операционной системы и использует для изоляции возможности не железа, а операционной системы, так называемое пространство имён. Если мы говорим о Docker, как о наиболее распространённой сейчас технологии виртуализации, используются так называемые cgroups в ядре Linux.  
  
Главное отличие ― способ работы. При виртуализации создается полностью отдельная операционная система. При контейнеризации используется ядро операционной системы той машины, на которой открывается контейнер.

Ещё одно значимое отличие ― размер и скорость работы. Размер виртуальной машины может составлять несколько гигабайт. Также для загрузки операционной системы и запуска приложений, которые в них размещены, требуется много времени. Контейнеры более лёгкие — их размер измеряется в мегабайтах. По сравнению с виртуальными машинами, контейнеры могут запускаться намного быстрее. 
#### Обычная виртуализация?
Виртуализация — **это**, говоря **простым** **языком**, запуск одной или нескольких систем в рамках другой операционной системы на одной вычислительной машине. 
#### ENV vs ARG  
**Инструкция ENV** в Dockerfile позволяет задавать постоянные переменные среды, которые будут доступны в контейнере во время его выполнения.

**Инструкция ARG** в Dockerfile позволяет задать переменную, значение которой можно передать из командной строки в образ во время его сборки. Значение для переменной по умолчанию можно представить в Dockerfile.

В отличие от ENV-переменных, ARG-переменные недоступны во время выполнения контейнера. Однако ARG-переменные можно использовать для задания значений по умолчанию для ENV-переменных из командной строки в процессе сборки образа.  
#### Docker Overlay2
это улучшенная версия файловой системы Overlay, которая обеспечивает лучшую производительность и надёжность по сравнению с её предшественницей.

Все слои контейнеров и изображений хранятся в каталоге /var/lib/docker/overlay2. Этот каталог может увеличиваться в размере со временем, поскольку новые контейнеры и изображения создаются и удаляются.
#### Папка overlay2  
В папке overlay2 хранятся слои (layers) контейнеров Docker. Когда вы запускаете контейнер в Docker, каждое изменение, сделанное в контейнере, сохраняется как отдельный слой. Overlay2 используется для управления этими слоями, обеспечивая эффективное хранение и управление изменениями в контейнерах. Таким образом, в папке overlay2 содержатся данные, необходимые для работы и настроек контейнеров Docker.  
#### Чистка системных данных docker’a
1. Очистить неиспользуемые образы Docker:
   Можно использовать команду `docker image prune` для удаления неиспользуемых образов. Она удалит все образы, не привязанные ни к одному контейнеру.

2. Удалить остановленные контейнеры:
   С помощью команды `docker container prune` можно удалить все контейнеры, которые были остановлены.

3. Очистить логи и кеши Docker:
   Также можно почистить логи и кеши Docker, используя команду `docker system prune -a`

4. Переместить данные Docker на другой диск:
   Если у тебя есть возможность, можно переместить данные Docker на другой диск, где есть больше свободного места.

5. Удалить ненужные Docker volume:
   Команда `docker volume prune` поможет удалить неиспользуемые Docker volume.
#### Просмотр логов docker-контейнера
1. **docker logs**: Команда `docker logs <container_id>` позволяет просматривать вывод контейнера. Например:
   `docker logs my_container`

2. **docker-compose logs**: Если вы используете Docker Compose, то можно воспользоваться командой `docker-compose logs <service_name>`. Например:
   `docker-compose logs web`

3. **Использование docker exec**: Вы можете выполнить команду внутри контейнера с помощью `docker exec` и вывести логи этой команды. Например:
   `docker exec -it my_container cat /var/log/nginx/access.log`

4. **Прямое чтение лог-файлов**: Вы также можете прямо прочитать лог-файлы контейнера, находящиеся внутри контейнера. Например:
   `docker exec -it my_container tail -f /var/log/nginx/error.log`
#### Ротация логов в docker’e  
Для ротации логов в Docker обычно используются лог-драйверы, которые позволяют автоматически управлять логами контейнеров. Ниже приведен пример использования лог-драйвера json-file в Docker Compose для ротации логов:

`version: '3.8'`
`services:`
  `web:`
    `image: nginx:latest`
    `container_name: my_web_container`
    `logging:`
      `driver: "json-file"`
      `options:`
        `max-size: "10m"`
        `max-file: "3"`

В этом примере мы определили, что логи контейнера web будут сохраняться в JSON-формате в файлы. Опция max-size указывает максимальный размер каждого файла логов, а опция max-file определяет количество файлов, которые будут сохранены до ротации.

Таким образом, при достижении максимального размера файла или количества файлов, Docker автоматически выполнит ротацию логов, предотвращая переполнение места на диске.