#вопросы_с_собесов #ansible
#### Terraform vs Ansible  
**Ansible** - это многоцелевой инструмент автоматизации, с его помощью можно решать различные задачи, в то время как **Terraform** - это инструмент для выполнения задач "инфраструктура как код", то есть инструмент превращения конфигурационных файлов в действующую инфраструктуру.  
#### Зачем нужны роли?  
Роль в Ansible — это независимая сущность, решающая какой-то свой набор задач. Говоря проще, роль — это директория с поддиректориями и файлами, где расположены задачи.  
#### Структура Ansible-роли

- defaults: содержит значения переменных по умолчанию. Эти значения могут быть изменены во время использования роли в плейбуке.
- files: сюда добавляются любые необходимые файлы, которые нужны роли.
- handlers: обработчики, которые могут быть использованы ролью.
- meta: содержит метаданные роли. Сюда входит лицензия, информация о платформе зависимости и многое другое.
- tasks: задачи роли, которые выполняются во время ее запуска.
- templates: шаблоны роли.
- tests: тесты роли.
- vars: переменные роли.
- README.md: описание, которое будет использоваться как документация.  
#### Переменные роли (defaults и vars)
Для определения переменных, Ansible предлагает два разных варианта: директорию defaults и директорию vars. И там и там хранятся переменные, которые роль использует для своей работы. Разница между этими директориями заключается в том, что в vars хранятся переменные, которые нужны роли для ее работы, но пользователю про них знать не нужно, это внутренние переменные. defaults же содержит переменные, которые пользователь роли может или должен задать при использовании этой роли. Типичный пример параметра по умолчанию, это номер версии устанавливаемой программы. Обычно его можно поменять, без необходимости менять внутренности роли.  
  
group_vars Общие переменные  
Название файла с переменными в group_vars должна соответствовать названию группы в файле инвентаризации  
   
Конструкция {{какое-то название}} — это ссылка на переменную
#### С какими системами управления конфигурациями работал (Ansible/Puppet/Chef и т.д)? Почему именно с ними, в чем между ними разница?  
**Ansible** отличается простотой использования, имеет безагентную архитектуру (не требует установки агента/клиента на целевую систему) и YAML-подобный DSL, написана на Python и легко расширяется за счет модулей. Обычно управляет конфигурацией Linux. Puppet имеет клиент-серверную архитектуру (периодически опрашивает сервер, чтобы внести в конфигурацию изменения, внесенные администратором сети), написана на Ruby и имеет Ruby-подобный DSL.
#### Структура Ansible-плейбука:

`name: Название сценария`
  `hosts: целевые_хосты`
  `become: право_привилегии`
  `vars:`
    `переменная1: значение`
    `переменная2: значение`
  `tasks:`
    `- name: Название задачи`
      `модуль:`
        `параметр1: значение`
        `параметр2: значение`
      `notify:`
        `- триггер обработчика`
  `handlers:`
    `- name: Название обработчика`
      `модуль:`
        `параметр1: значение`
        `параметр2: значение`

Можно определить несколько сценариев в одном плейбуке

`name: Другой сценарий`
  `hosts: другие_целевые_хосты`
  `roles:`
    `- роль1`
#### Свойство идемпотентности ансибл
Идемпотентность в контексте Ansible означает, что вы можете запускать один и тот же плейбук множество раз на одной и той же системе и получать одинаковый результат, без каких-либо неожиданных побочных эффектов после первого запуска.  
_Пример_  
если вы говорите Ansible установить пакет или создать файл, он проверит, существуют ли они уже в нужном состоянии, и если это так, Ansible не будет делать ничего лишнего.  
#### Запуск плейбука Ansible  
При запуске плейбука Ansible выполняет задачи по порядку, по одной за раз, для всех указанных хостов. Это поведение по умолчанию можно скорректировать с помощью стратегий.

Если при выполнении задачи происходит сбой, Ansible останавливает выполнение плейбука для этого хоста, но продолжает на других, где задача выполнена успешно.

Во время выполнения Ansible отображает информацию о статусе подключения, именах задач, статусе выполнения и наличии изменений. В конце Ansible предоставляет сводку по выполнению плейбука с указанием выполненных и невыполненных задач.

С помощью флага –limit можно ограничить выполнение плейбука несколькими хостами.
#### Ansible Vault  
_Создание нового зашифрованного файла_

Вы можете создать новый зашифрованный файл Ansible с помощью:  
`ansible-vault create credentials.yml`  
Эта команда выполнит следующие действия:

1.      Сначала вам будет предложено ввести новый пароль. Вам нужно будет указывать этот пароль при каждом доступе к содержимому файла, будь то редактирование, просмотр или просто запуск плейбука (или команд с использованием его значений).

2.      Затем откроется редактор командной строки по умолчанию, чтобы вы могли заполнить файл требуемым содержимым.

3.      Наконец, когда вы закончите редактирование, ansible-vault сохранит файл как зашифрованный.  

_Шифрование существующего файла Ansible_

Чтобы зашифровать существующий файл Ansible, вы можете использовать следующую команду:  
`ansible-vault encrypt` `credentials.yml`  
Эта команда запросит у вас пароль, который вам нужно будет вводить при каждом доступе к файлу credentials.yml.

_Просмотр содержимого зашифрованного файла_

Если вы хотите просмотреть содержимое файла, который ранее был зашифрован с помощью ansible-vault, и вам не нужно изменять его содержимое, вы можете использовать команду:  
`ansible-vault view` `credentials.yml`  
Она предложит вам указать пароль, который вы выбрали при первом шифровании файла с помощью ansible-vault.

_Редактирование зашифрованного файла_

Чтобы изменить содержимое файла, который ранее был зашифрован с помощью Ansible Vault, выполните:  
`ansible-vault edit` `credentials.yml`  
Эта команда предложит вам указать пароль, который вы выбрали при первом шифровании файла credentials.yml. После проверки пароля откроется редактор командной строки по умолчанию с незашифрованным содержимым файла, что позволит вам внести нужные изменения. По завершении вы можете сохранить и закрыть файл, как обычно, и обновленное содержимое будет сохранено и зашифровано.

_Расшифровка файлов_

Если вы хотите навсегда расшифровать файл, ранее зашифрованный с помощью ansible-vault, вы можете сделать это с помощью следующего синтаксиса:  
`ansible-vault decrypt` `credentials.yml`  
Эта команда предложит вам ввести тот пароль, который использовался при первом шифровании файла. После проверки пароля содержимое файла будет сохранено на диск в виде незашифрованных данных.