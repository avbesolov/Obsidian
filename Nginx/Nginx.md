#вопросы_с_собесов #nginx #web-сервер
#### Nginx
это Веб-сервер, Реверс прокси (балансировка)

Конф-файл в /etc/nginx/nginx.conf
Логи - /var/log/access.log

Управлять поведение веб-сервера можно через директивы (пара ключ-значение) и контексты {}

Основная конфигурация хранится в http-контексте
`http {`
            `server {`
            `listen 80;`
	`}`
`}`
#### Реверс-прокси  
Обратный **прокси**-сервер (**Reverse** **Proxy** Server) – это **прокси**-сервер, который действует от имени сервера и выполняет функции промежуточного узла между клиентами и серверами. В отличие от обычного **прокси**-сервера, который работает от имени клиента и перенаправляет запросы к серверам, обратный **прокси**-сервер получает запросы от клиентов и пересылает их на один или несколько серверов.  
  
**Обратный прокси-сервер (Reverse Proxy Server)** — это прокси-сервер, который действует от имени сервера и выполняет функции промежуточного узла между клиентами и серверами.

**Основная цель обратного прокси-сервера — обеспечить балансировку нагрузки и повысить производительность сервера.** Он распределяет запросы от клиентов между несколькими серверами, обрабатывает их и возвращает ответы клиенту.

**Преимущества обратного прокси-сервера:**
- балансировка нагрузки;
- кэширование;
- улучшенная безопасность;
- SSL-терминация;
- анонимность;
- упрощение масштабирования;
- гибкая настройка.
#### Уровни балансировки нагрузки

Выделяют **три уровня балансировки нагрузки**:

1.      **Сетевой**. Предполагает использование набора физических серверов.
2.      **Транспортный**. Предполагает использование балансировщика, который распределяет запросы по пулу в соответствии с заданными алгоритмами.
3.      **Прикладной**. Распределяет нагрузку с учётом запрашиваемых страниц, контента или действий.
#### Способы балансировки нагрузки в nginx

1. **Round Robin**. Веб-сервер будет передавать запросы бэкендам по очереди с учётом их весов.

2.      **Hash**. Данный метод определяет контрольную сумму на основе произвольного текста и/или переменных и ассоциирует каждый полученный результат с конкретным бэкендом.

2.      **IP Hash**. Ассоциация выполняется исходя из IP-адреса клиента и только для HTTP-запросов.

3.      **Least Connections**. NGINX определяет, с каким бэкендом меньше всего соединений в данный момент, и перенаправляет запрос на него (с учётом весов).

4.      **Random**. Запросы передаются случайным образом (с учётом весов).
#### Upstream 
определяет, куда **Nginx** будет передавать запросы после их получения. Она содержит IP-адреса группы серверов (бэкенда), на которые могут быть отправлены запросы в зависимости от выбранного метода регулирования нагрузки. По умолчанию **Nginx** использует метод балансировки round-robin для распределения мощности между серверами. Сегмент server определяет порт 80, через который **Nginx** будет получать запросы.
#### Где прописываются настройки **upstream?  
В конфигурационном файле Nginx** балансировка нагрузки и отказоустойчивость реализуются с помощью специального модуля **ngx_http_upstream**.

Директива **upstream** позволяет организовывать группы серверов, распределяя между ними запросы для проксирования в директивах **proxy_pass** и **fastcgi_pass**.

Кроме того, это даёт Nginx возможность реагировать на нештатные ситуации в апстриме. Например, в случае выхода из строя одного или нескольких серверов из группы запрос будет отправлен на следующий, работающий сервер апстрима.
#### Пример конфигурации:

`upstream **backend** {`
    `server backend1.example.com       weight=5;`
    `server backend2.example.com:8080;`
    `server unix:/tmp/backend3;`
    `server backup1.example.com:8080   backup;`
    `server backup2.example.com:8080   backup;`
`}`

`server {`
    `location / {`
        `proxy_pass http://**backend**;`
    `}`

`}`